<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Client 1</title>
</head>
<body>
<h2>Client 1</h2>
<script type="module">
    import * as Y from 'https://cdn.skypack.dev/yjs';
    import { WebsocketProvider } from 'https://cdn.skypack.dev/y-websocket';

    const doc = new Y.Doc();
    const wsProvider = new WebsocketProvider('ws://localhost:8084', 'my-room', doc);

    wsProvider.on('status', (event) => {
        console.log(`Client 1 status: ${event.status}`);
    });

    const array = doc.getArray('sharedArray');

    array.observe(event => {
        console.log('Array changed:', array.toArray());
    });

    wsProvider.on('sync', (isSynced) => {
        if (isSynced) {
            console.log('Document synced!');

            if (array.length === 0) {
                array.insert(0, ['Hello from the first client!']);
            }
        }
    });

    setTimeout(() => {
        array.push([`Client 1 added data at ${new Date().toLocaleTimeString()}`]);
    }, 3000);
</script>
</body>
</html>