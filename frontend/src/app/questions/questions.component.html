<div class="card mx-8">
    <p-progressSpinner
        class="flex align-items-center justify-content-center h-screen"
        *ngIf="loading"
        styleClass="w-4rem h-4rem"
        strokeWidth="8"
        animationDuration=".5s" />
    <p-toast />
    <ng-container *ngIf="!loading">
        <p-toolbar styleClass="mb-2 gap-2">
            <div class="p-justify-end">
                <p-button
                    icon="pi pi-plus"
                    severity="primary"
                    [outlined]="true"
                    label="New"
                    class="mr-2"
                    (onClick)="openNewQuestion()" />
                <p-button
                    icon="pi pi-trash"
                    severity="danger"
                    label="Delete"
                    (onClick)="deleteSelectedQuestions()"
                    [disabled]="!selectedQuestions || !selectedQuestions.length" />
            </div>
        </p-toolbar>
        <p-table
            sortField="id"
            [sortOrder]="1"
            [columns]="cols"
            [value]="questions"
            [(selection)]="selectedQuestions"
            datakey="id"
            [tableStyle]="{ 'table-layout': 'fixed' }"
            [paginator]="true"
            [rows]="5"
            [rowsPerPageOptions]="[5, 10, 20]"
            styleClass="p-datatable-gridlines-striped">
            <ng-template pTemplate="caption">
                <div class="flex">
                    <h3 class="m-0">Manage Questions</h3>
                </div>
            </ng-template>
            <ng-template pTemplate="header" let-columns>
                <tr>
                    <th style="width: 10%"><p-tableHeaderCheckbox /></th>
                    <th pSortableColumn="id" style="width: 10%">Id <p-sortIcon field="id" /></th>
                    <th style="width: 10%">Title</th>
                    <th style="width: 40%">Description</th>
                    <th style="width: 10%">Topics</th>
                    <th style="width: 10%">Difficulty</th>
                    <th style="width: 10%"></th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-question>
                <tr>
                    <td>
                        <p-tableCheckbox [value]="question" />
                    </td>
                    <td>{{ question.id }}</td>
                    <td>{{ question.title }}</td>
                    <td>{{ question.description }}</td>
                    <td>{{ question.topics.join(', ') }}</td>
                    <td>{{ question.difficulty }}</td>
                    <td>
                        <p-button
                            label="Edit"
                            severity="primary"
                            icon="pi pi-file-edit"
                            class="mr-2"
                            [text]="true"
                            (onClick)="editQuestion(question)" />
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </ng-container>
    <p-dialog header="Header" [(visible)]="isDialogVisible" [modal]="true" [style]="{ width: '25rem' }">
        <ng-template pTemplate="header">
            <div class="inline-flex align-items-center justify-content-center gap-2">
                <span class="font-bold white-space-nowrap"> Create new question </span>
            </div>
        </ng-template>

        <form [formGroup]="questionFormGroup">
            <div class="field grid col-12">
                <label for="title">Title</label>
                <input
                    formControlName="title"
                    type="text"
                    pInputText
                    id="title"
                    required
                    class="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full" />
                @if (isTitleInvalid) {
                    <small class="text-red-300">Title is required.</small>
                }
            </div>
            <div class="formgrid grid field">
                <div class="field col-12 md:col-6">
                    <label for="questionTopics">Topics</label>
                    <p-multiSelect
                        required="true"
                        [style]="{ width: '100%' }"
                        [options]="topics"
                        formControlName="selectedTopics"
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Select Topics" />
                    @if (isTopicsInvalid) {
                        <small class="text-red-300">Topic(s) is required.</small>
                    }
                </div>
                <div class="field col-12 md:col-6">
                    <label for="questionTopics">Difficulty</label>
                    <p-dropdown
                        [required]="true"
                        [style]="{ width: '100%' }"
                        [options]="difficulties"
                        formControlName="selectedDifficulty"
                        optionLabel="label"
                        optionValue="value"
                        placeholder="Select Difficulty" />
                    @if (isDifficultyInvalid) {
                        <small class="text-red-300">Difficulty is required.</small>
                    }
                </div>
            </div>
            <div class="field grid col-12" field>
                <label for="questionDescription">Description</label>
                <textarea
                    formControlName="description"
                    [required]="true"
                    id="questionDescription"
                    type="text"
                    rows="6"
                    class="text-base text-color surface-overlay p-2 border-1 border-solid surface-border border-round appearance-none outline-none focus:border-primary w-full">
                </textarea>
                @if (isDescriptionInvalid) {
                    <small class="text-red-300">Description is required.</small>
                }
            </div>
        </form>

        <ng-template pTemplate="footer">
            <p-button label="Cancel" [text]="true" severity="secondary" (onClick)="isDialogVisible = false" />
            <p-button
                label="Save"
                class="p-button-success"
                (onClick)="saveQuestion()"
                [disabled]="!questionFormGroup.valid" />
        </ng-template>
    </p-dialog>

    <p-confirmDialog [style]="{ width: '450px' }" />
</div>
